{% extends "base.html" %}

{% block title %}Game Session · Match Maker{% endblock %}
{% block body_class %}game-session{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/game-session.css') }}">
{% endblock %}

{% block intro %}
<p class="intro">Game Session</p>
{% endblock %}

{% block content %}
  <!-- Game Info -->
  <div class="game-info">
    <h2>Game #{{ game_no }}</h2>
    <p class="court">(Court A)</p>
  </div>

  <!-- Teams -->
  <div class="teams">
    <div class="team-box team-a">
      <span class="player">{{ team_a[0] }}</span> + <span class="player">{{ team_a[1] }}</span>
    </div>
    <div class="vs-circle">Vs</div>
    <div class="team-box team-b">
      <span class="player">{{ team_b[0] }}</span> + <span class="player">{{ team_b[1] }}</span>
    </div>
  </div>

  <!-- Scoreboard -->
  <div class="scoreboard">
    <div class="score team-a-score">
      <div class="score-number" id="scoreA">0</div>
      <div class="controls">
        <button type="button" class="btn-control" onclick="changeScore('A', -1)">−</button>
        <button type="button" class="btn-control" onclick="changeScore('A', 1)">+</button>
      </div>
    </div>
    <div class="score team-b-score">
      <div class="score-number" id="scoreB">0</div>
      <div class="controls">
        <button type="button" class="btn-control" onclick="changeScore('B', 1)">+</button>
        <button type="button" class="btn-control" onclick="changeScore('B', -1)">−</button>
      </div>
    </div>
  </div>

  <!-- Duration -->
  <p class="duration">Game Duration: <span id="duration">0’</span></p>

  <!-- Buttons -->
  <div class="button-row">
    <button type="button" class="btn btn-blue" onclick="endGame()">End This Game</button>
    <button type="button" class="btn btn-orange" onclick="nextMatch()">Next Match</button>
  </div>
{% endblock %}

{% block scripts %}
<script>
  let scoreA = 0, scoreB = 0;
  const limit = {{ point_limit|default(21) }};  // from Playground, default 21
  const durationEl = document.getElementById('duration');
  let seconds = 0;
  setInterval(() => {
    seconds++;
    let mins = Math.floor(seconds / 60);
    let secs = seconds % 60;
    durationEl.textContent = `${mins}’${secs.toString().padStart(2,'0')}`;
  }, 1000);

  function changeScore(team, delta) {
    if (team === 'A') {
      scoreA = Math.max(0, Math.min(limit, scoreA + delta));
      document.getElementById('scoreA').textContent = scoreA;
    } else {
      scoreB = Math.max(0, Math.min(limit, scoreB + delta));
      document.getElementById('scoreB').textContent = scoreB;
    }
  }

  function endGame() {
    alert(`Game Ended! Final Score: ${scoreA} - ${scoreB}`);
    // TODO: send result to backend via fetch/POST
  }

  function nextMatch() {
    alert("Next Match will be drawn!");
    window.location.href = "{{ url_for('drawing') }}";
  }
</script>
{% endblock %}
